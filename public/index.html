<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#ffffff">
    <title>TreeRoute ‚Äî CO‚ÇÇ Journey Tracker</title>
    <link rel="icon" type="image/png" href="/TreeRouteLogo2.png">
    <link rel="apple-touch-icon" href="/TreeRouteLogo2.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;0,9..40,800;1,9..40,400&family=Fraunces:opsz,wght@9..144,700;9..144,800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
</head>

<body>

    <div id="toastContainer"></div>

    <div class="modal-overlay" id="authModal">
        <div class="modal-card">
            <button class="modal-close" onclick="hideAuthModal()">&times;</button>
            <div class="modal-brand">üåø</div>
            <h2 class="modal-title" id="authTitle">Sign In</h2>
            <p class="modal-subtitle" id="authSubtitle">Track your impact and compete with others</p>
            <div class="auth-error" id="authError" style="display:none"></div>
            <form class="auth-form" onsubmit="handleAuth(event)">
                <div class="input-group">
                    <label class="input-label">Username</label>
                    <input type="text" id="authUsername" class="input-field" placeholder="your username" required>
                </div>
                <div class="input-group" id="emailGroup" style="display:none">
                    <label class="input-label">Email</label>
                    <input type="email" id="authEmail" class="input-field" placeholder="you@example.com">
                </div>
                <div class="input-group">
                    <label class="input-label">Password</label>
                    <input type="password" id="authPassword" class="input-field" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn-add" id="authSubmitBtn" style="margin-top:8px">Sign In</button>
            </form>
            <p class="modal-footer">
                <span id="authSwitchText">Don't have an account? </span>
                <a href="#" id="authSwitchLink" onclick="toggleAuthMode(); return false;">Register</a>
            </p>
        </div>
    </div>

    <nav class="navbar">
        <a href="#" class="navbar-brand" onclick="navigateTo('dashboard'); return false;">
            <img src="TreeRouteLogo2.png" alt="TreeRoute" class="navbar-logo">
            <span>TreeRoute</span>
        </a>
        <div class="navbar-links">
            <a href="#" class="nav-link active" data-page="dashboard"
                onclick="navigateTo('dashboard'); return false;">Dashboard</a>
            <a href="#" class="nav-link" data-page="journeys" onclick="navigateTo('journeys'); return false;">My
                Journeys</a>
            <a href="#" class="nav-link" data-page="leaderboard"
                onclick="navigateTo('leaderboard'); return false;">Leaderboard</a>

        </div>
        <div class="navbar-auth" id="nav-auth-area">
            <button class="btn-signin" onclick="showAuthModal('login')">Sign In</button>
        </div>
    </nav>

    <div class="page-wrapper">

        <div class="page-section active" id="page-dashboard">
            <div class="header">
                <div class="header-title">
                    <h1>CO<sub>2</sub> Journey Tracker</h1>
                </div>
                <p class="header-sub">Track your local journeys and see how much CO‚ÇÇ you save by choosing green
                    transport</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card stat-card-hero">
                    <div class="stat-card-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                        </svg>
                        CO‚ÇÇ Saved
                    </div>
                    <div class="stat-card-value green" id="stat-saved">0.0 kg</div>
                    <div class="stat-card-sub">vs taking the car</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                        </svg>
                        Total CO‚ÇÇ Emitted
                    </div>
                    <div class="stat-card-value dark" id="stat-emitted">0.0 kg</div>
                    <div class="stat-card-sub">from all journeys</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="10" />
                            <polyline points="12 6 12 12 16 14" />
                        </svg>
                        Total Distance
                    </div>
                    <div class="stat-card-value dark" id="stat-distance">0.0 km</div>
                    <div class="stat-card-sub" id="stat-distance-sub">across 0 journeys</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                            <circle cx="9" cy="7" r="4" />
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                        </svg>
                        Journeys
                    </div>
                    <div class="stat-card-value dark" id="stat-journeys">0</div>
                    <div class="stat-card-sub">total logged</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 2c1.5 0 3 1.5 3 4 0 2.5-3 6-3 6s-3-3.5-3-6c0-2.5 1.5-4 3-4z" />
                            <path d="M8.5 14a4 4 0 0 0 7 0" />
                            <path d="M6 18h12" />
                            <path d="M7 22h10" />
                        </svg>
                        Calories Burned
                    </div>
                    <div class="stat-card-value orange" id="stat-calories">0</div>
                    <div class="stat-card-sub" id="stat-calories-sub">select a green transport mode</div>
                </div>
            </div>

            <div class="card dash-activity-card" id="dashQuickInfo" style="display:none">
                <div class="dash-activity-header">
                    <div class="dash-streak-badge" id="dashStreakCard">
                        <span class="dash-streak-flame">üî•</span>
                        <div class="dash-streak-info">
                            <span class="dash-streak-count" id="dashStreakCount">0</span>
                            <span class="dash-streak-label" id="dashStreakLabel">day streak</span>
                        </div>
                    </div>
                    <div class="dash-challenges-progress" id="dashChallengesProgress">
                        <span class="dash-cp-label">Today's Goals</span>
                        <span class="dash-cp-count" id="dashCpCount">0/3</span>
                    </div>
                </div>
                <div class="dash-challenges-list" id="dashChallengesMini"></div>
            </div>

            <div class="bottom-grid">
                <div class="card">
                    <div class="card-title">Add Journey</div>
                    <div class="card-subtitle">Track your local trips and their carbon footprint</div>
                    <div class="map-container">
                        <div id="map"></div>
                        <div class="map-controls">
                            <button class="map-ctrl-btn" onclick="locateMe()" title="My location">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="4" /><path d="M12 2v4M12 18v4M2 12h4M18 12h4" />
                                </svg>
                            </button>
                            <button class="map-ctrl-btn" onclick="clearRoute()" title="Clear">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" />
                                </svg>
                            </button>
                        </div>
                        <div class="route-info-overlay" id="routeInfoOverlay" style="display:none">
                            <span id="routeDistText">‚Äî</span>
                            <span class="route-info-sep">¬∑</span>
                            <span id="routeTimeText">‚Äî</span>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="input-label">From (Point A)</div>
                        <div class="search-input-wrap">
                            <input type="text" id="originInput" class="input-field" placeholder="Search or tap the map">
                            <div class="search-dropdown" id="originResults"></div>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="input-label">To (Point B)</div>
                        <div class="search-input-wrap">
                            <input type="text" id="destInput" class="input-field" placeholder="Search or tap the map">
                            <div class="search-dropdown" id="destResults"></div>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="input-label">Distance (km) <span id="distHint" class="input-hint"></span></div>
                        <input type="number" id="distanceInput" class="input-field" step="0.1">
                    </div>

                    <div class="input-group">
                        <span class="transport-label">Transport Mode</span>
                        <div class="mode-grid">
                            <button class="mode-btn" data-mode="walk" onclick="selectMode('walk')"><span class="mode-emoji-label">üö∂</span><span class="mode-name">Walk</span><span class="mode-time" id="modeTime-walk"></span></button>
                            <button class="mode-btn" data-mode="bike" onclick="selectMode('bike')"><span class="mode-emoji-label">üö¥</span><span class="mode-name">Bike</span><span class="mode-time" id="modeTime-bike"></span></button>
                            <button class="mode-btn" data-mode="eScooter" onclick="selectMode('eScooter')"><span class="mode-emoji-label">üõ¥</span><span class="mode-name">E-Scooter</span><span class="mode-time" id="modeTime-eScooter"></span></button>
                            <button class="mode-btn" data-mode="bus" onclick="selectMode('bus')"><span class="mode-emoji-label">üöå</span><span class="mode-name">Bus</span><span class="mode-time" id="modeTime-bus"></span></button>
                            <button class="mode-btn" data-mode="train" onclick="selectMode('train')"><span class="mode-emoji-label">üöÜ</span><span class="mode-name">Train</span><span class="mode-time" id="modeTime-train"></span></button>
                            <button class="mode-btn" data-mode="car" onclick="selectMode('car')"><span class="mode-emoji-label">üöó</span><span class="mode-name">Car</span><span class="mode-time" id="modeTime-car"></span></button>
                        </div>
                    </div>

                    <button class="btn-add" id="addJourneyBtn" onclick="submitJourney()">Add Journey</button>
                </div>

                <div class="card tree-panel">
                    <div class="tree-panel-header">
                        <span style="font-size:18px;">üåç</span>
                        <h2>Your Ecosystem</h2>
                    </div>
                    <p class="tree-panel-sub" id="treeMessage">A barren desert. Save CO‚ÇÇ to bring it to life!</p>
                    <div class="eco-scene-container" onclick="clickTree()">
                        <div class="eco-sky" id="ecoSky">
                            <div class="sun" id="ecoSun"></div>
                            <div class="cloud cloud-1" id="cloud1">‚òÅÔ∏è</div>
                            <div class="cloud cloud-2" id="cloud2">‚òÅÔ∏è</div>
                            <div class="bird bird-1">üê¶</div>
                            <div class="bird bird-2">üê¶</div>
                            <div class="bird bird-3">üê¶</div>
                        </div>
                        <div class="eco-ground" id="ecoGround">
                            <div class="river" id="ecoRiver"></div>
                            <div class="flower-patch" id="ecoFlowers"></div>
                            <div class="tree-base">
                                <div class="trunk" id="trunk">
                                    <div class="branch branch-left" id="branchLeft"></div>
                                    <div class="branch branch-right" id="branchRight"></div>
                                </div>
                                <div class="leaves-wrap" id="leavesWrap"></div>
                            </div>
                            <div class="animal deer">ü¶å</div>
                            <div class="animal rabbit">üêá</div>
                            <div class="animal butterfly">ü¶ã</div>
                            <div class="animal frog">üê∏</div>
                            <div class="animal squirrel">üêøÔ∏è</div>
                            <div class="animal hedgehog">ü¶î</div>
                        </div>
                        <div class="particle-layer" id="particleLayer"></div>
                    </div>

                    <div class="co2-display" id="co2Display-section">
                        <div class="co2-value" id="co2Display">0.0</div>
                        <div class="co2-label">kg CO‚ÇÇ saved</div>
                    </div>
                    <div class="milestone-section">
                        <div class="milestone-row">
                            <span>Next milestone</span>
                            <span id="milestoneLabel">5 kg</span>
                        </div>
                        <div class="progress-bar-bg">
                            <div class="progress-bar-fill" id="progressFill"></div>
                        </div>
                        <div class="milestone-to-go" id="milestoneToGo">5.0 kg to go</div>
                    </div>
                </div>
            </div>

            <div class="comparison-section" id="comparisonSection" style="display:none">
                <div class="comparison-section-header" onclick="toggleComparison()">
                    <span class="comparison-section-title">Journey Comparison</span>
                    <svg class="comparison-toggle-btn" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9" />
                    </svg>
                </div>
                <div class="comparison-section-body" id="comparisonBody">
                    <div class="comparison-row">
                        <div class="comparison-item">
                            <span class="comp-label">Your CO‚ÇÇ</span>
                            <span class="comp-value" id="compYourCo2">0.00 kg</span>
                        </div>
                        <span class="comparison-vs">vs</span>
                        <div class="comparison-item">
                            <span class="comp-label">By Car</span>
                            <span class="comp-value comp-car" id="compCarCo2">0.00 kg</span>
                        </div>
                    </div>
                    <div class="comparison-savings" id="compSavings"></div>
                    <div id="modeComparisonSection" style="margin-top:16px;">
                        <canvas id="modeCompChart" height="200"></canvas>
                        <div id="modeCompCards" class="mode-comp-cards"></div>
                    </div>
                </div>
            </div>

            <div class="card recommendation-card" id="dashRecommendationCard" style="display:none">
                <div class="recommendation-header">
                    <span class="recommendation-icon">üí°</span>
                    <span class="recommendation-title">Smart Insights</span>
                </div>
                <div id="dashRecommendationList" class="recommendation-list"></div>
            </div>

            <div class="impact-section">
                <div class="impact-header">
                    <div class="impact-title">Your Tangible Impact</div>
                    <div class="impact-subtitle">See how your CO‚ÇÇ savings translate into real-world equivalents</div>
                </div>
                <div class="impact-grid">
                    <div class="impact-card">
                        <span class="impact-emoji">üêß</span>
                        <div class="impact-value" id="impact-penguins">0</div>
                        <div class="impact-label">Penguin Habits</div>
                        <div class="impact-desc">Daily foraging trips preserved</div>
                    </div>
                    <div class="impact-card">
                        <span class="impact-emoji">üå≥</span>
                        <div class="impact-value" id="impact-trees">0</div>
                        <div class="impact-label">Trees Equivalent</div>
                        <div class="impact-desc">Annual CO‚ÇÇ absorption matched</div>
                    </div>
                    <div class="impact-card">
                        <span class="impact-emoji">üì±</span>
                        <div class="impact-value" id="impact-phones">0</div>
                        <div class="impact-label">Phone Charges</div>
                        <div class="impact-desc">Smartphone charges offset</div>
                    </div>
                    <div class="impact-card">
                        <span class="impact-emoji">üéà</span>
                        <div class="impact-value" id="impact-blimps">0</div>
                        <div class="impact-label">Blimps of Gas</div>
                        <div class="impact-desc">Goodyear-size blimps avoided</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="page-section" id="page-journeys">
            <div class="header">
                <div class="header-title"><h1>My Journeys</h1></div>
                <p class="header-sub">Your complete travel history</p>
            </div>
            <div class="card">
                <div id="journeysList"></div>
                <div id="journeysPagination" style="display:flex;gap:6px;justify-content:center;margin-top:16px;"></div>
            </div>
        </div>

        <div class="page-section" id="page-leaderboard">
            <div class="header">
                <div class="header-title"><h1>Leaderboard</h1></div>
            </div>
            <div class="card leaderboard-card">
                <div class="leaderboard-tabs">
                    <button class="tab-btn active" data-type="co2" onclick="loadLeaderboard('co2')">CO‚ÇÇ Saved</button>
                    <button class="tab-btn" data-type="distance" onclick="loadLeaderboard('distance')">Distance</button>
                    <button class="tab-btn" data-type="xp" onclick="loadLeaderboard('xp')">XP</button>
                    <button class="tab-btn" data-type="streak" onclick="loadLeaderboard('streak')">Streak</button>
                </div>
                <div class="leaderboard-period">
                    <button class="period-btn active" data-period="all" onclick="togglePeriod('all')">All Time</button>
                    <button class="period-btn" data-period="week" onclick="togglePeriod('week')">This Week</button>
                </div>
                <div id="leaderboardContent"></div>
            </div>
        </div>

        <div class="page-section" id="page-profile">
            <header class="header">
                <div class="header-title">
                    <div class="header-icon">üë§</div>
                    <h1>Your Profile</h1>
                </div>
                <p class="header-sub">Track your progress, achievements, and environmental impact.</p>
            </header>

            <div class="stats-grid" id="profileStatsGrid">
                <div class="stat-card">
                    <div class="stat-card-label">Total Impact</div>
                    <div class="stat-card-value green" id="profileTotalImpact">0kg</div>
                    <div class="stat-card-sub">CO2 Saved Overall</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Community Rank</div>
                    <div class="stat-card-value dark" id="profileRank">#‚Äî</div>
                    <div class="stat-card-sub">Global Leaderboard</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Sustainability Score</div>
                    <div class="stat-card-value green" id="profileSustainability">0</div>
                    <div class="stat-card-sub">Your eco rating</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Account Age</div>
                    <div class="stat-card-value dark" id="profileAge">1d</div>
                    <div class="stat-card-sub">Member since <span id="profileMemberSince">‚Äî</span></div>
                </div>
            </div>

            <div class="card profile-level-card" id="profileLevelCard">
                <div class="level-card-header">
                    <div class="level-card-badge" id="profileLevelBadge">üå±</div>
                    <div class="level-card-info">
                        <div class="level-card-name" id="profileLevelName">Sprout ‚Äî Lvl 1</div>
                        <div class="level-card-xp" id="profileLevelXp">0 / 100 XP</div>
                    </div>
                </div>
                <div class="progress-bar-bg" style="margin-top:12px;">
                    <div class="progress-bar-fill" id="profileXpFill" style="width:0%"></div>
                </div>
                <div class="level-card-next" id="profileXpNext">100 XP to next level</div>
            </div>

            <div class="card profile-challenges-card" id="profileChallengesCard" style="display:none">
                <h2 class="card-title">Daily Challenges</h2>
                <div id="profileChallengesList" class="challenges-list"></div>
            </div>

            <div class="card profile-achievements-card" id="profileAchievementsCard" style="display:none">
                <h2 class="card-title">Achievements</h2>
                <div id="profileAchievementsGrid" class="achievements-grid"></div>
            </div>

            <div class="bottom-grid profile-grid">
                <section class="card">
                    <h2 class="card-title">Your Stats</h2>
                    <p class="card-subtitle">Detailed activity breakdown</p>
                    <div class="profile-stats-list" id="profileStatsList">
                        <div class="profile-stat-row"><span class="profile-stat-icon">üî•</span><span class="profile-stat-label">Current Streak</span><span class="profile-stat-value" id="pStatStreak">0 days</span></div>
                        <div class="profile-stat-row"><span class="profile-stat-icon">üèÖ</span><span class="profile-stat-label">Longest Streak</span><span class="profile-stat-value" id="pStatLongestStreak">0 days</span></div>
                        <div class="profile-stat-row"><span class="profile-stat-icon">‚è±Ô∏è</span><span class="profile-stat-label">Total Travel Time</span><span class="profile-stat-value" id="pStatTravelTime">0 min</span></div>
                        <div class="profile-stat-row"><span class="profile-stat-icon">üå≥</span><span class="profile-stat-label">Trees Equivalent</span><span class="profile-stat-value" id="pStatTrees">0</span></div>
                        <div class="profile-stat-row"><span class="profile-stat-icon">üî•</span><span class="profile-stat-label">Total Calories</span><span class="profile-stat-value" id="pStatCalories">0</span></div>
                        <div class="profile-stat-row"><span class="profile-stat-icon">üìè</span><span class="profile-stat-label">Total Distance</span><span class="profile-stat-value" id="pStatDistance">0 km</span></div>
                    </div>
                </section>

                <section class="card">
                    <h2 class="card-title">Personal Information</h2>
                    <p class="card-subtitle">Update your display name and email address.</p>
                    <form id="profileForm" onsubmit="handleProfileUpdate(event)">
                        <div class="input-group">
                            <label class="input-label">Username</label>
                            <input type="text" class="input-field" id="profileUser" placeholder="Enter username">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Email Address</label>
                            <input type="email" class="input-field" id="profileEmail" placeholder="Enter email">
                        </div>
                        <button type="submit" class="btn-add">Save Changes</button>
                    </form>
                    <div style="margin-top: 16px;">
                        <button class="btn-ghost" onclick="handleLogout()" style="width: 100%; border-color: #fca5a5; color: #dc2626; background: transparent; padding: 10px; border-radius: 8px; cursor: pointer;">Log Out</button>
                    </div>
                </section>
            </div>

        </div>

    </div>

    <nav class="mobile-bottom-nav">
        <button class="bnav-btn active" data-page="dashboard" onclick="navigateTo('dashboard')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" />
            </svg>
            <span>Home</span>
        </button>
        <button class="bnav-btn" data-page="journeys" onclick="navigateTo('journeys')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" /><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76" />
            </svg>
            <span>Journeys</span>
        </button>
        <button class="bnav-btn" data-page="leaderboard" onclick="navigateTo('leaderboard')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" /><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" />
                <path d="M4 22h16" /><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20 7 22" />
                <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20 17 22" />
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" />
            </svg>
            <span>Leaderboard</span>
        </button>
    </nav>

    <script src="app.js"></script>
    <script src="profile.js"></script>
</body>
</html>