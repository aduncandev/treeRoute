<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#ffffff">
    <title>TreeRoute ‚Äî CO‚ÇÇ Journey Tracker</title>
    <link rel="icon" type="image/png" href="/TreeRouteLogo2.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;0,9..40,800;1,9..40,400&family=Fraunces:opsz,wght@9..144,700;9..144,800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <!-- Auth Modal -->
    <div class="modal-overlay" id="authModal">
        <div class="modal-card">
            <button class="modal-close" onclick="hideAuthModal()">&times;</button>
            <div class="modal-brand">üåø</div>
            <h2 class="modal-title" id="authTitle">Sign In</h2>
            <p class="modal-subtitle" id="authSubtitle">Track your impact and compete with others</p>
            <div class="auth-error" id="authError" style="display:none"></div>
            <form class="auth-form" onsubmit="handleAuth(event)">
                <div class="input-group">
                    <label class="input-label">Username</label>
                    <input type="text" id="authUsername" class="input-field" placeholder="your username" required>
                </div>
                <div class="input-group" id="emailGroup" style="display:none">
                    <label class="input-label">Email</label>
                    <input type="email" id="authEmail" class="input-field" placeholder="you@example.com">
                </div>
                <div class="input-group">
                    <label class="input-label">Password</label>
                    <input type="password" id="authPassword" class="input-field" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn-add" id="authSubmitBtn" style="margin-top:8px">Sign In</button>
            </form>
            <p class="modal-footer">
                <span id="authSwitchText">Don't have an account? </span>
                <a href="#" id="authSwitchLink" onclick="toggleAuthMode(); return false;">Register</a>
            </p>
        </div>
    </div>

    <!-- Navigation Bar -->
    <nav class="navbar">
        <a href="#" class="navbar-brand" onclick="navigateTo('dashboard'); return false;">
            <img src="TreeRouteLogo2.png" alt="TreeRoute" class="navbar-logo">
            <span>TreeRoute</span>
        </a>
        <div class="navbar-links">
            <a href="#" class="nav-link active" data-page="dashboard"
                onclick="navigateTo('dashboard'); return false;">Dashboard</a>
            <a href="#" class="nav-link" data-page="journeys" onclick="navigateTo('journeys'); return false;">My
                Journeys</a>
            <a href="#" class="nav-link" data-page="leaderboard"
                onclick="navigateTo('leaderboard'); return false;">Leaderboard</a>
        </div>
        <div class="navbar-auth" id="nav-auth-area">
            <button class="btn-signin" onclick="showAuthModal('login')">Sign In</button>
        </div>
    </nav>

    <div class="page-wrapper">

        <!-- ========== DASHBOARD PAGE ========== -->
        <div class="page-section active" id="page-dashboard">

            <!-- Header -->
            <div class="header">
                <div class="header-title">
                    <h1>CO<sub>2</sub> Journey Tracker</h1>
                </div>
                <p class="header-sub">Track your local journeys and see how much CO‚ÇÇ you save by choosing green
                    transport</p>
            </div>

            <!-- Stats Row -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                        </svg>
                        CO‚ÇÇ Saved
                    </div>
                    <div class="stat-card-value green" id="stat-saved">0.0 kg</div>
                    <div class="stat-card-sub">vs taking the car</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                        </svg>
                        Total CO‚ÇÇ Emitted
                    </div>
                    <div class="stat-card-value dark" id="stat-emitted">0.0 kg</div>
                    <div class="stat-card-sub">from all journeys</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="10" />
                            <polyline points="12 6 12 12 16 14" />
                        </svg>
                        Total Distance
                    </div>
                    <div class="stat-card-value dark" id="stat-distance">0.0 km</div>
                    <div class="stat-card-sub" id="stat-distance-sub">across 0 journeys</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                            <circle cx="9" cy="7" r="4" />
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                        </svg>
                        Journeys
                    </div>
                    <div class="stat-card-value dark" id="stat-journeys">0</div>
                    <div class="stat-card-sub">total logged</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 2c1.5 0 3 1.5 3 4 0 2.5-3 6-3 6s-3-3.5-3-6c0-2.5 1.5-4 3-4z" />
                            <path d="M8.5 14a4 4 0 0 0 7 0" />
                            <path d="M6 18h12" />
                            <path d="M7 22h10" />
                        </svg>
                        Calories Burned
                    </div>
                    <div class="stat-card-value orange" id="stat-calories">0</div>
                    <div class="stat-card-sub" id="stat-calories-sub">select a green transport mode</div>
                </div>
            </div>

            <!-- Bottom Grid -->
            <div class="bottom-grid">

                <!-- Add Journey Card -->
                <div class="card">
                    <div class="card-title">Add Journey</div>
                    <div class="card-subtitle">Track your local trips and their carbon footprint</div>

                    <!-- Map -->
                    <div class="map-container">
                        <div id="map"></div>
                        <div class="map-controls">
                            <button class="map-ctrl-btn" onclick="locateMe()" title="My location">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="12" cy="12" r="4" />
                                    <path d="M12 2v4M12 18v4M2 12h4M18 12h4" />
                                </svg>
                            </button>
                            <button class="map-ctrl-btn" onclick="clearRoute()" title="Clear">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18" />
                                    <line x1="6" y1="6" x2="18" y2="18" />
                                </svg>
                            </button>
                        </div>
                        <div class="route-info-overlay" id="routeInfoOverlay" style="display:none">
                            <span id="routeDistText">‚Äî</span>
                            <span class="route-info-sep">¬∑</span>
                            <span id="routeTimeText">‚Äî</span>
                        </div>
                    </div>

                    <!-- Origin -->
                    <div class="input-group">
                        <div class="input-label">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                                <circle cx="12" cy="10" r="3" />
                            </svg>
                            From (Point A)
                        </div>
                        <div class="search-input-wrap">
                            <input type="text" id="originInput" class="input-field" placeholder="Search or tap the map"
                                autocomplete="off">
                            <div class="search-dropdown" id="originResults"></div>
                        </div>
                    </div>

                    <!-- Destination -->
                    <div class="input-group">
                        <div class="input-label">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#22c55e"
                                stroke-width="2.5">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                                <circle cx="12" cy="10" r="3" />
                            </svg>
                            To (Point B)
                        </div>
                        <div class="search-input-wrap">
                            <input type="text" id="destInput" class="input-field" placeholder="Search or tap the map"
                                autocomplete="off">
                            <div class="search-dropdown" id="destResults"></div>
                        </div>
                    </div>

                    <!-- Distance (auto-filled from route, or manual) -->
                    <div class="input-group">
                        <div class="input-label">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5">
                                <path d="M18 6L6 18" />
                                <path d="M6 6l12 12" />
                            </svg>
                            Distance (km) <span class="input-hint" id="distHint"></span>
                        </div>
                        <input type="number" id="distanceInput" class="input-field"
                            placeholder="Auto-calculated from map, or enter manually" min="0.1" step="0.1"
                            autocomplete="off">
                    </div>

                    <!-- Transport Mode -->
                    <div class="input-group">
                        <span class="transport-label">Transport Mode</span>
                        <div class="mode-grid">
                            <button class="mode-btn" data-mode="walk" onclick="selectMode('walk')">
                                <span class="mode-emoji">üö∂</span><span class="mode-name">Walk</span>
                            </button>
                            <button class="mode-btn" data-mode="bike" onclick="selectMode('bike')">
                                <span class="mode-emoji">üö¥</span><span class="mode-name">Bike</span>
                            </button>
                            <button class="mode-btn" data-mode="eScooter" onclick="selectMode('eScooter')">
                                <span class="mode-emoji">üõ¥</span><span class="mode-name">E-Scooter</span>
                            </button>
                            <button class="mode-btn" data-mode="bus" onclick="selectMode('bus')">
                                <span class="mode-emoji">üöå</span><span class="mode-name">Bus</span>
                            </button>
                            <button class="mode-btn" data-mode="train" onclick="selectMode('train')">
                                <span class="mode-emoji">üöÜ</span><span class="mode-name">Train</span>
                            </button>
                            <button class="mode-btn" data-mode="car" onclick="selectMode('car')">
                                <span class="mode-emoji">üöó</span><span class="mode-name">Car</span>
                            </button>
                        </div>
                    </div>

                    <button class="btn-add" id="addJourneyBtn" onclick="submitJourney()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5">
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                        Add Journey
                    </button>

                    <!-- Comparison Card (hidden by default) -->
                    <div class="comparison-card" id="comparisonCard">
                        <div class="comparison-title">Journey Impact</div>
                        <div class="comparison-row">
                            <div class="comparison-item">
                                <span class="comp-label">Your CO‚ÇÇ</span>
                                <span class="comp-value" id="compYourCo2">0.00 kg</span>
                            </div>
                            <div class="comparison-vs">vs</div>
                            <div class="comparison-item">
                                <span class="comp-label">By Car</span>
                                <span class="comp-value comp-car" id="compCarCo2">0.00 kg</span>
                            </div>
                        </div>
                        <div class="comparison-savings" id="compSavings"></div>
                    </div>
                </div>

                <!-- Ecosystem Panel -->
                <div class="card tree-panel">
                    <div class="tree-panel-header">
                        <span style="font-size:18px;">üåç</span>
                        <h2>Your Ecosystem</h2>
                    </div>
                    <p class="tree-panel-sub" id="treeMessage">A barren desert. Save CO‚ÇÇ to bring it to life!</p>

                    <!-- Scene -->
                    <div class="eco-scene-container" onclick="clickTree()">
                        <div class="eco-sky" id="ecoSky">
                            <div class="sun" id="ecoSun"></div>
                            <div class="cloud cloud-1" id="ecoCloud1">‚òÅÔ∏è</div>
                            <div class="cloud cloud-2" id="ecoCloud2">‚òÅÔ∏è</div>
                            <div class="bird bird-1">ü¶Ö</div>
                            <div class="bird bird-2">üïäÔ∏è</div>
                            <div class="bird bird-3">ü¶ú</div>
                        </div>
                        <div class="eco-ground" id="ecoGround">
                            <div class="river" id="ecoRiver"></div>
                            <div class="flower-patch" id="ecoFlowers"></div>
                            <div class="tree-base">
                                <div class="trunk" id="trunk">
                                    <div class="branch branch-left" id="branchLeft"></div>
                                    <div class="branch branch-right" id="branchRight"></div>
                                </div>
                                <div class="leaves-wrap" id="leavesWrap"></div>
                            </div>
                            <div class="animal deer">ü¶å</div>
                            <div class="animal rabbit">üêá</div>
                            <div class="animal butterfly">ü¶ã</div>
                            <div class="animal frog">üê∏</div>
                            <div class="animal squirrel">üêøÔ∏è</div>
                            <div class="animal hedgehog">ü¶î</div>
                        </div>
                        <div class="particle-layer" id="particleLayer"></div>
                    </div>

                    <div class="co2-display">
                        <div class="co2-value"><span id="co2Display">0.0</span> kg</div>
                        <div class="co2-label">CO‚ÇÇ Saved</div>
                    </div>

                    <!-- Milestone -->
                    <div class="milestone-section">
                        <div class="milestone-row">
                            <span>Next milestone</span>
                            <span id="milestoneLabel">15 kg</span>
                        </div>
                        <div class="progress-bar-bg">
                            <div class="progress-bar-fill" id="progressFill"></div>
                        </div>
                        <div class="milestone-to-go" id="milestoneToGo">15.0 kg to go</div>
                    </div>
                </div>

            </div>
        </div>

        <!-- ========== JOURNEYS PAGE ========== -->
        <div class="page-section" id="page-journeys">
            <div class="header">
                <div class="header-title">
                    <h1>My Journeys</h1>
                </div>
                <p class="header-sub">Your complete travel history</p>
            </div>
            <div class="card">
                <div id="journeysList">
                    <div class="empty-state">
                        <div class="empty-icon">üó∫Ô∏è</div>
                        <p>No journeys yet. Log your first journey from the dashboard!</p>
                    </div>
                </div>
                <div id="journeysPagination" style="display:flex;gap:6px;justify-content:center;padding-top:16px;">
                </div>
            </div>
        </div>

        <!-- ========== LEADERBOARD PAGE ========== -->
        <div class="page-section" id="page-leaderboard">
            <div class="header">
                <div class="header-title">
                    <h1>Leaderboard</h1>
                </div>
                <p class="header-sub">See how you stack up against other green travellers</p>
            </div>
            <div class="card leaderboard-card">
                <div class="leaderboard-tabs">
                    <button class="tab-btn active" data-type="co2" onclick="loadLeaderboard('co2')">CO‚ÇÇ Saved</button>
                    <button class="tab-btn" data-type="distance" onclick="loadLeaderboard('distance')">Distance</button>
                    <button class="tab-btn" data-type="xp" onclick="loadLeaderboard('xp')">XP</button>
                    <button class="tab-btn" data-type="streak" onclick="loadLeaderboard('streak')">Streak</button>
                </div>
                <div class="leaderboard-period">
                    <button class="period-btn active" data-period="all" onclick="togglePeriod('all')">All Time</button>
                    <button class="period-btn" data-period="week" onclick="togglePeriod('week')">This Week</button>
                </div>
                <div id="leaderboardContent">
                    <div class="empty-state">
                        <div class="empty-icon">üèÜ</div>
                        <p>Loading leaderboard...</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-bottom-nav">
        <button class="bnav-btn active" data-page="dashboard" onclick="navigateTo('dashboard')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                <polyline points="9 22 9 12 15 12 15 22" />
            </svg>
            <span>Home</span>
        </button>
        <button class="bnav-btn" data-page="journeys" onclick="navigateTo('journeys')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76" />
            </svg>
            <span>Journeys</span>
        </button>
        <button class="bnav-btn" data-page="leaderboard" onclick="navigateTo('leaderboard')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 22h16" />
                <path d="M10 22V2h4v20" />
                <path d="M6 22V10h4" />
                <path d="M14 22V10h4" />
            </svg>
            <span>Rank</span>
        </button>
    </nav>

    <script src="app.js"></script>
</body>

</html>