<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#ffffff">
    <title>TreeRoute ‚Äî CO‚ÇÇ Journey Tracker</title>
    <link rel="icon" type="image/png" href="/TreeRouteLogo2.png">
    <link rel="apple-touch-icon" href="/TreeRouteLogo2.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;0,9..40,800;1,9..40,400&family=Fraunces:opsz,wght@9..144,700;9..144,800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div id="toastContainer"></div>

    <div class="modal-overlay" id="authModal">
        <div class="modal-card">
            <button class="modal-close" onclick="hideAuthModal()">&times;</button>
            <div class="modal-brand">üåø</div>
            <h2 class="modal-title" id="authTitle">Sign In</h2>
            <p class="modal-subtitle" id="authSubtitle">Track your impact and compete with others</p>
            <div class="auth-error" id="authError" style="display:none"></div>
            <form class="auth-form" onsubmit="handleAuth(event)">
                <div class="input-group">
                    <label class="input-label">Username</label>
                    <input type="text" id="authUsername" class="input-field" placeholder="your username" required>
                </div>
                <div class="input-group" id="emailGroup" style="display:none">
                    <label class="input-label">Email</label>
                    <input type="email" id="authEmail" class="input-field" placeholder="you@example.com">
                </div>
                <div class="input-group">
                    <label class="input-label">Password</label>
                    <input type="password" id="authPassword" class="input-field" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn-add" id="authSubmitBtn" style="margin-top:8px">Sign In</button>
            </form>
            <p class="modal-footer">
                <span id="authSwitchText">Don't have an account? </span>
                <a href="#" id="authSwitchLink" onclick="toggleAuthMode(); return false;">Register</a>
            </p>
        </div>
    </div>

    <nav class="navbar">
        <a href="#" class="navbar-brand" onclick="navigateTo('dashboard'); return false;">
            <img src="TreeRouteLogo2.png" alt="TreeRoute" class="navbar-logo">
            <span>TreeRoute</span>
        </a>
        <div class="navbar-links">
            <a href="#" class="nav-link active" data-page="dashboard"
                onclick="navigateTo('dashboard'); return false;">Dashboard</a>
            <a href="#" class="nav-link" data-page="journeys" onclick="navigateTo('journeys'); return false;">My
                Journeys</a>
            <a href="#" class="nav-link" data-page="leaderboard"
                onclick="navigateTo('leaderboard'); return false;">Leaderboard</a>

        </div>
        <div class="navbar-auth" id="nav-auth-area">
            <button class="btn-signin" onclick="showAuthModal('login')">Sign In</button>
        </div>
    </nav>

    <div class="page-wrapper">

        <div class="page-section active" id="page-dashboard">
            <div class="header">
                <div class="header-title">
                    <h1>CO<sub>2</sub> Journey Tracker</h1>
                </div>
                <p class="header-sub">Track your local journeys and see how much CO‚ÇÇ you save by choosing green
                    transport</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                        </svg>
                        CO‚ÇÇ Saved
                    </div>
                    <div class="stat-card-value green" id="stat-saved">0.0 kg</div>
                    <div class="stat-card-sub">vs taking the car</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                        </svg>
                        Total CO‚ÇÇ Emitted
                    </div>
                    <div class="stat-card-value dark" id="stat-emitted">0.0 kg</div>
                    <div class="stat-card-sub">from all journeys</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="10" />
                            <polyline points="12 6 12 12 16 14" />
                        </svg>
                        Total Distance
                    </div>
                    <div class="stat-card-value dark" id="stat-distance">0.0 km</div>
                    <div class="stat-card-sub" id="stat-distance-sub">across 0 journeys</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                            <circle cx="9" cy="7" r="4" />
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                        </svg>
                        Journeys
                    </div>
                    <div class="stat-card-value dark" id="stat-journeys">0</div>
                    <div class="stat-card-sub">total logged</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 2c1.5 0 3 1.5 3 4 0 2.5-3 6-3 6s-3-3.5-3-6c0-2.5 1.5-4 3-4z" />
                            <path d="M8.5 14a4 4 0 0 0 7 0" />
                            <path d="M6 18h12" />
                            <path d="M7 22h10" />
                        </svg>
                        Calories Burned
                    </div>
                    <div class="stat-card-value orange" id="stat-calories">0</div>
                    <div class="stat-card-sub" id="stat-calories-sub">select a green transport mode</div>
                </div>
            </div>

            <div class="bottom-grid">
                <div class="card">
                    <div class="card-title">Add Journey</div>
                    <div class="card-subtitle">Track your local trips and their carbon footprint</div>
                    <div class="map-container">
                        <div id="map"></div>
                        <div class="map-controls">
                            <button class="map-ctrl-btn" onclick="locateMe()" title="My location">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="4" /><path d="M12 2v4M12 18v4M2 12h4M18 12h4" />
                                </svg>
                            </button>
                            <button class="map-ctrl-btn" onclick="clearRoute()" title="Clear">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" />
                                </svg>
                            </button>
                        </div>
                        <div class="route-info-overlay" id="routeInfoOverlay" style="display:none">
                            <span id="routeDistText">‚Äî</span>
                            <span class="route-info-sep">¬∑</span>
                            <span id="routeTimeText">‚Äî</span>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="input-label">From (Point A)</div>
                        <div class="search-input-wrap">
                            <input type="text" id="originInput" class="input-field" placeholder="Search or tap the map">
                            <div class="search-dropdown" id="originResults"></div>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="input-label">To (Point B)</div>
                        <div class="search-input-wrap">
                            <input type="text" id="destInput" class="input-field" placeholder="Search or tap the map">
                            <div class="search-dropdown" id="destResults"></div>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="input-label">Distance (km)</div>
                        <input type="number" id="distanceInput" class="input-field" step="0.1">
                    </div>

                    <div class="input-group">
                        <span class="transport-label">Transport Mode</span>
                        <div class="mode-grid">
                            <button class="mode-btn" data-mode="walk" onclick="selectMode('walk')">üö∂ Walk</button>
                            <button class="mode-btn" data-mode="bike" onclick="selectMode('bike')">üö¥ Bike</button>
                            <button class="mode-btn" data-mode="eScooter" onclick="selectMode('eScooter')">üõ¥ E-Scooter</button>
                            <button class="mode-btn" data-mode="bus" onclick="selectMode('bus')">üöå Bus</button>
                            <button class="mode-btn" data-mode="train" onclick="selectMode('train')">üöÜ Train</button>
                            <button class="mode-btn" data-mode="car" onclick="selectMode('car')">üöó Car</button>
                        </div>
                    </div>

                    <button class="btn-add" id="addJourneyBtn" onclick="submitJourney()">Add Journey</button>
                </div>

                <div class="card tree-panel">
                    <div class="tree-panel-header">
                        <span style="font-size:18px;">üåç</span>
                        <h2>Your Ecosystem</h2>
                    </div>
                    <p class="tree-panel-sub" id="treeMessage">A barren desert. Save CO‚ÇÇ to bring it to life!</p>
                    <div class="eco-scene-container" onclick="clickTree()">
                        <div class="eco-sky" id="ecoSky">
                            <div class="sun" id="ecoSun"></div>
                        </div>
                        <div class="eco-ground" id="ecoGround">
                            <div class="tree-base">
                                <div class="trunk" id="trunk"></div>
                                <div class="leaves-wrap" id="leavesWrap"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="page-section" id="page-journeys">
            <div class="header">
                <div class="header-title"><h1>My Journeys</h1></div>
                <p class="header-sub">Your complete travel history</p>
            </div>
            <div class="card">
                <div id="journeysList"></div>
            </div>
        </div>

        <div class="page-section" id="page-leaderboard">
            <div class="header">
                <div class="header-title"><h1>Leaderboard</h1></div>
            </div>
            <div class="card leaderboard-card">
                <div id="leaderboardContent"></div>
            </div>
        </div>

        <div class="page-section" id="page-profile">
            <header class="header">
                <div class="header-title">
                    <div class="header-icon">üë§</div>
                    <h1>Account Settings</h1>
                </div>
                <p class="header-sub">Manage your profile and environmental impact preferences.</p>
            </header>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-label">Total Impact</div>
                    <div class="stat-card-value green" id="profileTotalImpact">0kg</div>
                    <div class="stat-card-sub">CO2 Saved Overall</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Community Rank</div>
                    <div class="stat-card-value dark" id="profileRank">#‚Äî</div>
                    <div class="stat-card-sub">Global Leaderboard</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Trees Planted</div>
                    <div class="stat-card-value green" id="profileTrees">0</div>
                    <div class="stat-card-sub">Virtual Ecosystem</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Account Age</div>
                    <div class="stat-card-value dark" id="profileAge">1d</div>
                    <div class="stat-card-sub">Member since 2024</div>
                </div>
            </div>

            <div class="bottom-grid">
                <section class="card">
                    <h2 class="card-title">Personal Information</h2>
                    <p class="card-subtitle">Update your display name and email address.</p>
                    
                    <form id="profileForm" onsubmit="handleProfileUpdate(event)">
                        <div class="input-group">
                            <label class="input-label">Username</label>
                            <input type="text" class="input-field" id="profileUser" placeholder="Enter username">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Email Address</label>
                            <input type="email" class="input-field" id="profileEmail" placeholder="Enter email">
                        </div>
                        <button type="submit" class="btn-add">Save Changes</button>
                    </form>
                </section>

                <section class="card">
                    <h2 class="card-title">Preferences</h2>
                    <p class="card-subtitle">Customize how you track your emissions.</p>
                    
                    <div class="input-group">
                        <span class="transport-label">Primary Transport Mode</span>
                        <div class="mode-grid">
                            <button class="mode-btn active">üö≤ <span class="mode-name">Cycling</span></button>
                            <button class="mode-btn">üöå <span class="mode-name">Bus</span></button>
                            <button class="mode-btn">üöó <span class="mode-name">Car</span></button>
                        </div>
                    </div>

                    <div style="margin-top: 24px;">
                        <button class="btn-ghost" onclick="handleLogout()" style="width: 100%; border-color: #fca5a5; color: #dc2626; background: transparent; padding: 10px; border-radius: 8px; cursor: pointer;">Log Out</button>
                    </div>
                </section>
            </div>
        </div>

    </div>

    <nav class="mobile-bottom-nav">
        <button class="bnav-btn active" data-page="dashboard" onclick="navigateTo('dashboard')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" />
            </svg>
            <span>Home</span>
        </button>
        <button class="bnav-btn" data-page="journeys" onclick="navigateTo('journeys')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" /><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76" />
            </svg>
            <span>Journeys</span>
        </button>
        <button class="bnav-btn" data-page="profile" onclick="navigateTo('profile')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" />
            </svg>
            <span>Profile</span>
        </button>
    </nav>

    <script src="app.js"></script>
    <script src="profile.js"></script>
</body>
</html>