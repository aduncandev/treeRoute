<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0f0a">
    <title>TreeRoute</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;0,9..40,800;1,9..40,400&family=Fraunces:opsz,wght@9..144,700;9..144,800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <!-- Auth Modal -->
    <div class="modal-overlay" id="authModal">
        <div class="modal-card">
            <button class="modal-close" onclick="hideAuthModal()">&times;</button>
            <div class="modal-brand">üåø</div>
            <h2 class="modal-title" id="authTitle">Sign In</h2>
            <p class="modal-subtitle" id="authSubtitle">Track your impact and compete with others</p>
            <div class="auth-error" id="authError" style="display:none"></div>
            <div class="auth-form" id="authForm">
                <div class="input-group">
                    <label class="input-label">Username</label>
                    <input type="text" id="authUsername" class="input-field" placeholder="your username" required>
                </div>
                <div class="input-group" id="emailGroup" style="display:none">
                    <label class="input-label">Email</label>
                    <input type="email" id="authEmail" class="input-field" placeholder="you@example.com">
                </div>
                <div class="input-group">
                    <label class="input-label">Password</label>
                    <input type="password" id="authPassword" class="input-field" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="button" class="btn-primary" id="authSubmitBtn" onclick="handleAuth()"
                    style="margin-top:8px">Sign In</button>
            </div>
            <p class="modal-footer">
                <span id="authSwitchText">Don't have an account? </span>
                <a href="#" id="authSwitchLink" onclick="toggleAuthMode(); return false;">Register</a>
            </p>
        </div>
    </div>

    <!-- Top Header Bar (mobile) -->
    <header class="top-bar">
        <a href="#" class="top-bar-brand" onclick="navigateTo('dashboard'); return false;">
            <span class="brand-icon">üåø</span>
            <span class="brand-text">TreeRoute</span>
        </a>
        <div class="top-bar-right" id="topBarRight">
            <button class="btn-signin-sm" onclick="showAuthModal('login')">Sign In</button>
        </div>
    </header>

    <!-- Page Content -->
    <main class="page-content">

        <!-- ========== DASHBOARD ========== -->
        <div class="page active" id="page-dashboard">
            <!-- Greeting / Level -->
            <div class="greeting-bar" id="greetingBar">
                <div class="greeting-text">
                    <span class="greeting-hello" id="greetingHello">Hello there!</span>
                    <span class="greeting-sub" id="greetingSub">Start tracking your green journeys</span>
                </div>
                <div class="xp-pill" id="xpPill" style="display:none">
                    <span class="xp-level" id="xpLevel">Lvl 1</span>
                    <div class="xp-bar-mini">
                        <div class="xp-bar-fill-mini" id="xpBarFill"></div>
                    </div>
                </div>
            </div>

            <!-- Stats Strip -->
            <div class="stats-strip">
                <div class="stat-chip">
                    <span class="stat-chip-value green" id="stat-saved">0.0</span>
                    <span class="stat-chip-label">kg CO‚ÇÇ saved</span>
                </div>
                <div class="stat-chip">
                    <span class="stat-chip-value" id="stat-distance">0.0</span>
                    <span class="stat-chip-label">km travelled</span>
                </div>
                <div class="stat-chip">
                    <span class="stat-chip-value" id="stat-journeys">0</span>
                    <span class="stat-chip-label">journeys</span>
                </div>
                <div class="stat-chip">
                    <span class="stat-chip-value amber" id="stat-streak">0</span>
                    <span class="stat-chip-label">day streak</span>
                </div>
            </div>

            <!-- Add Journey Card with Map -->
            <div class="card journey-card">
                <div class="card-header">
                    <h2>Log a Journey</h2>
                    <span class="card-hint">Tap the map or search to set your route</span>
                </div>

                <!-- Map -->
                <div class="map-wrapper">
                    <div id="map"></div>
                    <div class="map-actions">
                        <button class="map-action-btn" id="locateMeBtn" onclick="locateMe()" title="My location">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="4" />
                                <path d="M12 2v4M12 18v4M2 12h4M18 12h4" />
                            </svg>
                        </button>
                        <button class="map-action-btn" id="clearMapBtn" onclick="clearRoute()" title="Clear route">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18" />
                                <line x1="6" y1="6" x2="18" y2="18" />
                            </svg>
                        </button>
                    </div>

                    <!-- Route Info Overlay -->
                    <div class="route-info" id="routeInfo" style="display:none">
                        <div class="route-info-item">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5">
                                <path d="M18 6L6 18" />
                                <path d="M8 6h10v10" />
                            </svg>
                            <span id="routeDistText">‚Äî</span>
                        </div>
                        <div class="route-info-item">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5">
                                <circle cx="12" cy="12" r="10" />
                                <polyline points="12 6 12 12 16 14" />
                            </svg>
                            <span id="routeTimeText">‚Äî</span>
                        </div>
                    </div>
                </div>

                <!-- Location Inputs -->
                <div class="location-inputs">
                    <div class="loc-input-row">
                        <div class="loc-dot origin-dot"></div>
                        <div class="loc-input-wrap">
                            <input type="text" id="originInput" class="loc-input"
                                placeholder="Start point ‚Äî search or tap map" autocomplete="off">
                            <div class="search-results" id="originResults"></div>
                        </div>
                    </div>
                    <div class="loc-connector"></div>
                    <div class="loc-input-row">
                        <div class="loc-dot dest-dot"></div>
                        <div class="loc-input-wrap">
                            <input type="text" id="destInput" class="loc-input"
                                placeholder="Destination ‚Äî search or tap map" autocomplete="off">
                            <div class="search-results" id="destResults"></div>
                        </div>
                    </div>
                </div>

                <!-- Transport Mode -->
                <div class="mode-section">
                    <span class="mode-section-label">How did you travel?</span>
                    <div class="mode-scroll">
                        <button class="mode-chip" data-mode="walk" onclick="selectMode('walk')">
                            <span class="mode-chip-icon">üö∂</span><span>Walk</span>
                        </button>
                        <button class="mode-chip" data-mode="bike" onclick="selectMode('bike')">
                            <span class="mode-chip-icon">üö¥</span><span>Bike</span>
                        </button>
                        <button class="mode-chip" data-mode="eScooter" onclick="selectMode('eScooter')">
                            <span class="mode-chip-icon">üõ¥</span><span>E-Scooter</span>
                        </button>
                        <button class="mode-chip" data-mode="bus" onclick="selectMode('bus')">
                            <span class="mode-chip-icon">üöå</span><span>Bus</span>
                        </button>
                        <button class="mode-chip" data-mode="train" onclick="selectMode('train')">
                            <span class="mode-chip-icon">üöÜ</span><span>Train</span>
                        </button>
                        <button class="mode-chip" data-mode="car" onclick="selectMode('car')">
                            <span class="mode-chip-icon">üöó</span><span>Car</span>
                        </button>
                    </div>
                </div>

                <!-- Manual Distance (collapsible) -->
                <details class="manual-distance">
                    <summary>Enter distance manually</summary>
                    <div class="manual-distance-inner">
                        <input type="number" id="distanceInput" class="input-field" placeholder="Distance in km"
                            min="0.1" step="0.1">
                    </div>
                </details>

                <button class="btn-primary btn-log" id="addJourneyBtn" onclick="submitJourney()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2.5">
                        <line x1="12" y1="5" x2="12" y2="19" />
                        <line x1="5" y1="12" x2="19" y2="12" />
                    </svg>
                    Log Journey
                </button>

                <!-- Comparison Card (after submit) -->
                <div class="impact-card" id="comparisonCard">
                    <div class="impact-header">Journey Impact</div>
                    <div class="impact-grid">
                        <div class="impact-stat">
                            <span class="impact-label">Your CO‚ÇÇ</span>
                            <span class="impact-value green" id="compYourCo2">‚Äî</span>
                        </div>
                        <div class="impact-vs">vs</div>
                        <div class="impact-stat">
                            <span class="impact-label">By car</span>
                            <span class="impact-value muted" id="compCarCo2">‚Äî</span>
                        </div>
                    </div>
                    <div class="impact-badges" id="compSavings"></div>
                </div>
            </div>

            <!-- Ecosystem Card -->
            <div class="card eco-card">
                <div class="eco-header">
                    <span class="eco-emoji" id="ecoEmoji">üå±</span>
                    <div>
                        <h3 class="eco-title" id="ecoTitle">Your Ecosystem</h3>
                        <p class="eco-sub" id="ecoMessage">Save CO‚ÇÇ to grow your forest!</p>
                    </div>
                </div>
                <div class="eco-scene" id="ecoScene" onclick="clickTree()">
                    <div class="eco-sky" id="ecoSky">
                        <div class="sun" id="ecoSun"></div>
                        <div class="bird bird-1">ü¶Ö</div>
                        <div class="bird bird-2">ü¶Ö</div>
                    </div>
                    <div class="eco-ground" id="ecoGround">
                        <div class="river" id="ecoRiver"></div>
                        <div class="tree-base">
                            <div class="trunk" id="trunk"></div>
                            <div class="leaves-wrap" id="leavesWrap"></div>
                        </div>
                        <div class="animal deer">ü¶å</div>
                        <div class="animal butterfly">ü¶ã</div>
                        <div class="animal frog">üê∏</div>
                    </div>
                </div>
                <div class="eco-co2">
                    <span class="eco-co2-val" id="co2Display">0.0</span>
                    <span class="eco-co2-unit">kg CO‚ÇÇ saved</span>
                </div>
                <div class="milestone-bar">
                    <div class="milestone-labels">
                        <span>Next milestone</span>
                        <span id="milestoneLabel">5 kg</span>
                    </div>
                    <div class="progress-track">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <span class="milestone-remaining" id="milestoneToGo">5.0 kg to go</span>
                </div>
            </div>
        </div>

        <!-- ========== JOURNEYS PAGE ========== -->
        <div class="page" id="page-journeys">
            <div class="page-title-bar">
                <h1>My Journeys</h1>
                <p>Your travel history</p>
            </div>
            <div class="card">
                <div id="journeysList">
                    <div class="empty-state">
                        <div class="empty-icon">üó∫Ô∏è</div>
                        <p>No journeys yet. Start from the dashboard!</p>
                    </div>
                </div>
                <div id="journeysPagination" class="pagination"></div>
            </div>
        </div>

        <!-- ========== LEADERBOARD PAGE ========== -->
        <div class="page" id="page-leaderboard">
            <div class="page-title-bar">
                <h1>Leaderboard</h1>
                <p>Compete with other green travellers</p>
            </div>
            <div class="card lb-card">
                <div class="lb-tabs">
                    <button class="lb-tab active" data-type="co2" onclick="loadLeaderboard('co2')">CO‚ÇÇ</button>
                    <button class="lb-tab" data-type="distance" onclick="loadLeaderboard('distance')">Distance</button>
                    <button class="lb-tab" data-type="xp" onclick="loadLeaderboard('xp')">XP</button>
                    <button class="lb-tab" data-type="streak" onclick="loadLeaderboard('streak')">Streak</button>
                </div>
                <div class="lb-period">
                    <button class="period-chip active" data-period="all" onclick="togglePeriod('all')">All Time</button>
                    <button class="period-chip" data-period="week" onclick="togglePeriod('week')">This Week</button>
                </div>
                <div id="leaderboardContent">
                    <div class="empty-state">
                        <div class="empty-icon">üèÜ</div>
                        <p>Loading...</p>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Bottom Tab Navigation (mobile first) -->
    <nav class="bottom-nav">
        <button class="bnav-tab active" data-page="dashboard" onclick="navigateTo('dashboard')">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                <polyline points="9 22 9 12 15 12 15 22" />
            </svg>
            <span>Home</span>
        </button>
        <button class="bnav-tab" data-page="journeys" onclick="navigateTo('journeys')">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76" />
            </svg>
            <span>Journeys</span>
        </button>
        <button class="bnav-tab" data-page="leaderboard" onclick="navigateTo('leaderboard')">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5C7 4 7 7 7 7" />
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5C17 4 17 7 17 7" />
                <path d="M4 22h16" />
                <path d="M10 22V2h4v20" />
                <path d="M6 22V10h4" />
                <path d="M14 22V10h4" />
            </svg>
            <span>Rank</span>
        </button>
    </nav>

    <script src="app.js"></script>
</body>

</html>